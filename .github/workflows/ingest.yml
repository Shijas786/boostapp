name: Ingest Base App Buys

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  ingest:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Ingestion
        run: |
          # Fetch the VERCEL_URL if set, otherwise fallback to local/hardcoded for testing
          # Note: In production GitHub Actions, you should set VERCEL_URL as a secret or environment variable
          APP_URL="${VERCEL_URL:-https://boostapp-phi.vercel.app}"
          echo "Triggering $APP_URL/api/ingest"
          curl -X GET "$APP_URL/api/ingest" \
            -H "Authorization: Bearer ${{ secrets.CRON_SECRET }}"
        env:
          VERCEL_URL: ${{ secrets.VERCEL_URL }}
